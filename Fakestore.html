<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FakeStore API</title>

  <!-- Tailwind Play CDN for quick styling (no build step) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Axios CDN -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <style>
    /* small extra styles */
    .glass {
      background: rgba(255,255,255,0.7);
      backdrop-filter: blur(6px);
    }
  </style>
</head>
<body class="bg-gradient-to-b from-slate-50 to-slate-100 min-h-screen text-slate-800">

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <header class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 flex items-center justify-center rounded-lg bg-blue-600 text-white font-bold text-lg">FS</div>
        <div>
          <h1 class="text-2xl sm:text-3xl font-extrabold">FakeStore</h1>
          <p class="text-sm text-slate-500">Fetched from <code class="text-xs bg-slate-100 px-2 py-1 rounded">https://fakestoreapi.com/users</code></p>
        </div>
      </div>

      <div class="w-full sm:w-auto flex items-center gap-3">
        <div class="relative flex-1 sm:flex-none w-full">
          <input id="search" type="search" placeholder="Search by name, username, email or city"
                 class="w-full sm:w-80 px-3 py-2 rounded-lg border border-slate-200 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-300" />
        </div>

        <button id="refreshBtn" class="px-4 py-2 rounded-lg bg-blue-600 text-white shadow hover:bg-blue-1000">Refresh</button>
      </div>
    </header>

    <!-- Status area -->
    <div id="statusArea" class="mb-4"></div>

    <!-- Content -->
    <main>
      <section id="grid" class="grid gap-6 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4"></section>

      <!-- Empty / fallback -->
      <div id="empty" class="hidden text-center text-slate-500 mt-6">No users found.</div>
    </main>

    <footer class="mt-10 text-center text-sm text-slate-500">
      build for React Redux • Dynamic API Integration * Responsive • Loading & error states handled
    </footer>
  </div>

  <script>
  (function () {
    const API = 'https://fakestoreapi.com/users';
    const grid = document.getElementById('grid');
    const statusArea = document.getElementById('statusArea');
    const empty = document.getElementById('empty');
    const searchInput = document.getElementById('search');
    const refreshBtn = document.getElementById('refreshBtn');

    let users = [];
    let cached = false;

    // render helpers
    function showLoading(message = 'Loading users...') {
      statusArea.innerHTML = `
        <div class="p-4 rounded-lg glass shadow-sm flex items-center gap-4">
          <svg class="animate-spin h-6 w-6 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
          </svg>
          <div class="text-sm text-slate-600">${escapeHtml(message)}</div>
        </div>
      `;
      grid.innerHTML = '';
      empty.classList.add('hidden');
    }

    function showError(message = 'Failed to load users') {
      statusArea.innerHTML = `
        <div class="p-4 rounded-lg bg-red-50 border border-red-100 text-red-700 flex items-start justify-between gap-4">
          <div>
            <div class="font-semibold">Error</div>
            <div class="text-sm">${escapeHtml(message)}</div>
          </div>
          <div class="flex items-center gap-2">
            <button id="retry" class="px-3 py-1 bg-white border rounded text-sm">Retry</button>
          </div>
        </div>
      `;
      document.getElementById('retry')?.addEventListener('click', fetchAndRender);
      grid.innerHTML = '';
      empty.classList.add('hidden');
    }

    function showInfo(message) {
      statusArea.innerHTML = `
        <div class="p-3 rounded-lg bg-white border border-slate-100 text-slate-600 text-sm">${escapeHtml(message)}</div>
      `;
    }

    function renderUsers(list) {
      grid.innerHTML = list.map(userCardHtml).join('');
      empty.classList.toggle('hidden', list.length > 0);
      attachCardHandlers();
    }

    function userCardHtml(u) {
      const name = (u?.name?.firstname || '') + ' ' + (u?.name?.lastname || '');
      const initials = ((u?.name?.firstname||'')[0] || '') + ((u?.name?.lastname||'')[0] || '');
      const city = u?.address?.city || '';
      const street = u?.address?.street || '';
      return `
      <article class="bg-white rounded-2xl shadow-sm p-4 hover:shadow-md transition">
        <div class="flex items-center gap-3">
          <div class="w-14 h-14 rounded-xl flex items-center justify-center bg-blue-50 text-blue-700 text-lg font-semibold">${escapeHtml(initials.toUpperCase() || 'U')}</div>
          <div class="flex-1 min-w-0">
            <div class="flex items-center justify-between gap-3">
              <h3 class="text-md font-semibold truncate">${escapeHtml(name || u.username || 'Unknown')}</h3>
              <div class="text-xs text-slate-400">ID ${escapeHtml(String(u.id))}</div>
            </div>
            <div class="text-sm text-slate-500 truncate">${escapeHtml(u.username || '')}</div>
          </div>
        </div>

        <div class="mt-3 text-sm text-slate-600 space-y-1">
          <div><span class="font-medium">Email:</span> ${escapeHtml(u.email || '—')}</div>
          <div><span class="font-medium">Phone:</span> ${escapeHtml(u.phone || '—')}</div>
          <div><span class="font-medium">Address:</span> ${escapeHtml([street, city].filter(Boolean).join(', ') || '—')}</div>
        </div>

        <div class="mt-4 flex items-center justify-between">
          <div class="text-xs text-slate-400">Last login: <span class="text-slate-500">—</span></div>
          <div class="flex items-center gap-2">
            <button class="openBtn text-sm px-3 py-1 rounded bg-slate-50 border">View</button>
            <div class="text-sm text-slate-400">•</div>
            <div class="text-sm text-slate-500">${escapeHtml(u.email ? maskEmail(u.email) : '')}</div>
          </div>
        </div>
      </article>
      `;
    }

    function attachCardHandlers() {
      document.querySelectorAll('.openBtn').forEach((btn, idx) => {
        btn.addEventListener('click', (e) => {
          const card = e.currentTarget.closest('article');
          // find id
          const idNode = card.querySelector('.text-xs.text-slate-400, .text-xs'); // fallback
          // display a small modal-like overlay with details (simple)
          const index = Array.from(grid.children).indexOf(card);
          showDetailModal(filteredUsers()[index]);
        });
      });
    }

    // small modal
    function showDetailModal(u) {
      const name = (u?.name?.firstname || '') + ' ' + (u?.name?.lastname || '');
      const html = `
        <div class="fixed inset-0 z-50 flex items-center justify-center p-4">
          <div class="absolute inset-0 bg-black/50" id="modalBg"></div>
          <div class="relative bg-white rounded-2xl shadow-xl max-w-xl w-full p-6 z-10">
            <div class="flex items-start gap-4">
              <div class="w-16 h-16 rounded-lg flex items-center justify-center bg-blue-50 text-blue-700 text-xl font-bold">${escapeHtml(((u?.name?.firstname||'')[0] || '') + ((u?.name?.lastname||'')[0] || ''))}</div>
              <div class="flex-1">
                <h3 class="text-lg font-bold">${escapeHtml(name || u.username)}</h3>
                <div class="text-sm text-slate-500">${escapeHtml(u.username || '')}</div>
              </div>
              <button id="closeModalBtn" class="text-slate-400 hover:text-slate-600">✕</button>
            </div>

            <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm text-slate-700">
              <div>
                <div class="font-medium text-slate-600">Contact</div>
                <div class="mt-1">Email: ${escapeHtml(u.email || '—')}</div>
                <div>Phone: ${escapeHtml(u.phone || '—')}</div>
              </div>
              <div>
                <div class="font-medium text-slate-600">Address</div>
                <div class="mt-1">${escapeHtml([u.address?.street, u.address?.city, u.address?.zipcode].filter(Boolean).join(', ') || '—')}</div>
                <div class="mt-2 text-xs text-slate-400">Geolocation: ${escapeHtml((u.address?.geolocation?.lat || '-') + ', ' + (u.address?.geolocation?.long || '-'))}</div>
              </div>
            </div>

            <div class="mt-6 text-right">
              <button id="closeModalBtn2" class="px-3 py-1 rounded bg-slate-100">Close</button>
            </div>
          </div>
        </div>
      `;
      document.body.insertAdjacentHTML('beforeend', html);
      document.getElementById('modalBg').addEventListener('click', closeModal);
      document.getElementById('closeModalBtn').addEventListener('click', closeModal);
      document.getElementById('closeModalBtn2').addEventListener('click', closeModal);

      function closeModal() {
        document.querySelectorAll('.fixed.inset-0').forEach(n => n.remove());
      }
    }

    // filtering
    function filteredUsers() {
      const q = (searchInput.value || '').toLowerCase().trim();
      if (!q) return users;
      return users.filter(u => {
        const name = ((u?.name?.firstname || '') + ' ' + (u?.name?.lastname || '')).toLowerCase();
        const username = (u.username || '').toLowerCase();
        const email = (u.email || '').toLowerCase();
        const city = (u.address?.city || '').toLowerCase();
        return name.includes(q) || username.includes(q) || email.includes(q) || city.includes(q);
      });
    }

    // data operations
    async function fetchAndRender() {
      showLoading();
      try {
        const res = await axios.get(API, { timeout: 10000 });
        if (!Array.isArray(res.data)) throw new Error('Unexpected API response');
        users = res.data;
        cached = true;
        showInfo(`Loaded ${users.length} users`);
        renderUsers(filteredUsers());
      } catch (err) {
        console.error(err);
        showError(err?.message || 'Network error. Please check your connection.');
      }
    }

    // helpers
    function escapeHtml(s) { if (s === null || s === undefined) return ''; return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
    function maskEmail(e) {
      if (!e) return '';
      const [u, d] = e.split('@');
      if (!u) return e;
      const visible = u.slice(0, Math.max(1, Math.min(3, u.length)));
      return visible + '…@' + d;
    }

    // events
    refreshBtn.addEventListener('click', async () => {
      // force refetch
      users = [];
      cached = false;
      await fetchAndRender();
    });

    let typingTimer = null;
    searchInput.addEventListener('input', () => {
      clearTimeout(typingTimer);
      typingTimer = setTimeout(() => {
        const list = filteredUsers();
        showInfo(`${list.length} user(s) match`);
        renderUsers(list);
      }, 220);
    });

    // initial
    fetchAndRender();

    // expose for debugging
    window.__fs_demo = { fetchAndRender, getUsers: () => users };
  })();
  </script>
</body>
</html>